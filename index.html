  <!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Personal Messages</title>

  <style>
    :root {
      --card-bg: rgba(255,255,255,.88);
      --text: #000;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background:
        linear-gradient(180deg, rgba(255,255,255,.7), rgba(255,255,255,.9)),
        url("clouds.png");
      background-size: cover;
      background-position: center;
      padding: 32px 16px;
      color: var(--text);
    }

    .wrap {
      max-width: 900px;
      margin: 0 auto;
    }

    .card {
      background: var(--card-bg);
      border-radius: 18px;
      padding: 24px;
      box-shadow: 0 10px 30px rgba(0,0,0,.15);
      backdrop-filter: blur(8px);
    }

    h1 {
      text-align: center;
      margin-top: 0;
    }

    /* Code Entry */
    #code-entry {
      text-align: center;
      margin-bottom: 20px;
    }

    #code-input {
      padding: 10px 14px;
      font-size: 16px;
      border-radius: 999px;
      border: 1px solid #ccc;
      width: 220px;
      text-align: center;
    }

    #code-btn {
      margin-left: 8px;
      padding: 10px 16px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-weight: 600;
    }

    /* Buttons */
    .buttons {
      display: none;
      justify-content: center;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 16px;
    }

    .btn {
      padding: 10px 14px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-weight: 600;
      background: #e5e7eb;
    }

    .btn:hover {
      background: #d1d5db;
    }

    /* Message */
    .message {
      text-align: center;
      font-size: clamp(18px, 2.2vw, 22px);
      line-height: 1.6;
      margin-top: 12px;
      white-space: pre-wrap;
    }

    /* Change code */
    #change-code {
      display: none;
      text-align: center;
      margin-top: 16px;
    }

    #change-code button {
      background: none;
      border: none;
      cursor: pointer;
      text-decoration: underline;
      font-size: 14px;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card">
      <h1 id="page-title">Personal Messages</h1>

      <!-- Code Entry -->
      <div id="code-entry">
        <input id="code-input" placeholder="Enter your code" />
        <button id="code-btn">Continue</button>
      </div>

      <!-- Name Buttons -->
      <div class="buttons" id="buttons"></div>

      <!-- Message -->
      <div class="message" id="message-text">
        Enter your code to begin.
      </div>

      <!-- Change Code -->
      <div id="change-code">
        <button id="change-code-btn">Enter a different code</button>
      </div>
    </div>
  </div>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js";

    /* ðŸ”§ REPLACE WITH YOUR FIREBASE CONFIG */
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT.firebaseapp.com",
      projectId: "YOUR_PROJECT_ID"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const buttonsDiv = document.getElementById("buttons");
    const messageText = document.getElementById("message-text");
    const codeEntry = document.getElementById("code-entry");
    const changeCode = document.getElementById("change-code");
    const pageTitle = document.getElementById("page-title");

    let messages = {};

    /* Load messages using CODE */
    async function loadByCode(code) {
      const ref = doc(db, "messageBatches", code);
      const snap = await getDoc(ref);

      if (!snap.exists()) {
        alert("Invalid code");
        return;
      }

      const data = snap.data();
      messages = data.messages || {};

      showButtonsFromFirebase();
      messageText.textContent = "Select a name to read their message.";
    }

    /* Create buttons dynamically from Firebase */
    function showButtonsFromFirebase() {
      buttonsDiv.innerHTML = "";
      buttonsDiv.style.display = "flex";
      codeEntry.style.display = "none";
      changeCode.style.display = "block";

      const names = Object.keys(messages).sort((a, b) =>
        a.localeCompare(b)
      );

      names.forEach(name => {
        const btn = document.createElement("button");
        btn.className = "btn";
        btn.textContent = name;

        btn.onclick = () => {
          messageText.textContent = messages[name];
        };

        buttonsDiv.appendChild(btn);
      });
    }

    /* Event Listeners */
    document.getElementById("code-btn").onclick = () => {
      const code = document.getElementById("code-input").value.trim();
      if (code) loadByCode(code);
    };

    document.getElementById("change-code-btn").onclick = () => {
      buttonsDiv.style.display = "none";
      changeCode.style.display = "none";
      codeEntry.style.display = "block";
      messageText.textContent = "Enter your code to begin.";
      document.getElementById("code-input").value = "";
    };
  </script>
</body>
</html>
